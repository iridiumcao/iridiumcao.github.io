# ç¬¬äº”ç«  Git Repository çš„ç›®å½•ç»“æ„

[â‡¦ä¸Šä¸€ç« ](04.md) - [é¦–é¡µğŸ ](index.md) - [ä¸‹ä¸€ç« â‡¨](06.md)

---

[ä¸Šä¸€ç« ](04.md)é€šè¿‡ `git init` åœ¨æœ¬åœ°åˆ›å»ºäº†ä¸€ä¸ª git repo, å¹¶åˆæ­¥ä½“éªŒäº†ä¸€ä¸‹ç‰ˆæœ¬ç®¡ç†çš„æ¦‚å¿µã€‚æœ¬ç« å°†ç®€å•è¯´æ˜ git çš„æ•°æ®æ˜¯å¦‚ä½•å­˜æ”¾çš„ã€‚

Git ç®¡ç†æ–‡ä»¶åˆ†ä¸ºä¸‰ä¸ªåŒºåŸŸï¼š

* Working Directory: åˆç§° Workspace, å·¥ä½œåŒºï¼Œç¼–è¾‘çš„æ–‡æ¡£éƒ½åœ¨è¿™é‡Œï¼Œäººç±»ç”¨æˆ·ç›´æ¥æ¥è§¦çš„åŒºåŸŸ
* Staging Area: åˆç§° Stage/Index, stage, index, cache ç­‰ï¼Œæš‚å­˜åŒºï¼Œæ–‡æ¡£æ”¹åŠ¨åœ¨å…¥åº“ä¹‹å‰å­˜æ”¾çš„åŒºåŸŸ
* Local Repository: ä»“åº“åŒºï¼Œæˆ–æœ¬åœ° repo

![](images/ch05_01_local_repo_areas.png)

ä¸‹é¢ä¸¾ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œæ‰“å¼€æœ¬åœ°ä»“åº“ä¸‹çš„ .git ç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ–‡ä»¶ï¼š

```plaintext
test_repo
â”œâ”€.git
â”‚   â”œâ”€hooks
â”‚   â”œâ”€info
â”‚   â”œâ”€logs
â”‚   â”‚  â””â”€refs
â”‚   â”‚      â””â”€heads
â”‚   â”œâ”€objects
â”‚   â”‚  â”œâ”€02
â”‚   â”‚  â”œâ”€9a
â”‚   â”‚  â”œâ”€ac
â”‚   â”‚  â”œâ”€c7
â”‚   â”‚  â”œâ”€cd
â”‚   â”‚  â”œâ”€e8
â”‚   â”‚  â”œâ”€info
â”‚   â”‚  â””â”€pack
â”‚   â””â”€refs
â”‚       â”œâ”€heads
â”‚       â””â”€tags
â””â”€helloworld.txt
```

åœ¨è¿™ä¸ªæ ‘å½¢ç›®å½•é‡Œï¼š

* `.git`
  * Local Repository
  * Staging Area
* å…¶ä»–æ‰€æœ‰æ–‡ä»¶ï¼šWorking Directory

ä¸€èˆ¬ä¸éœ€è¦åŒºåˆ†ã€Œä»“åº“ã€(Local Repository, Repo)å’Œ Staging Area æ—¶ï¼Œæˆ‘ä»¬ä¹ æƒ¯æŠŠ `.git` å°±å«åº“ã€‚éœ€è¦åŒºåˆ†æ—¶ï¼Œä¼šç‰¹åˆ«æŒ‡å‡ºã€‚å…·ä½“çœ‹ä¸Šä¸‹æ–‡è¯­å¢ƒã€‚
Working Directory æ˜¯æ•´ä¸ªå¯è§†ç›®å½•ï¼Œç›¸å½“äºæ’é™¤ `.git` çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚

æˆ‘ä»¬å¹³å¸¸æ‰€è°“çš„ä»£ç å…¥åº“ï¼Œæ˜¯æŒ‡æŠŠå˜åŒ–æäº¤ (commit) åˆ°æœ¬åœ° repo é‡Œã€‚
æ”¹åŠ¨çš„æ–‡ä»¶ï¼Œå¦‚æœè¿˜æ²¡æ‰§è¡Œ `add` æ“ä½œï¼Œå°±éƒ½åœ¨ Working Direcory ä¸­ï¼Œä½†å¦‚æœæ‰§è¡Œäº† `add` æ“ä½œï¼Œåˆ™è¿›å…¥ Staging Area ä¸­ï¼Œå†æ‰§è¡Œ `commit`ï¼Œå°±å…¥åº“äº†ã€‚è¿™äº›æ“ä½œå’Œæœ¬æ–‡å¼€å¤´çš„å›¾æ˜¯ä¸€è‡´çš„ã€‚

## `git init`

`git init` å¹²äº†ä»€ä¹ˆï¼Ÿå®ƒåªå¹²äº†ä¸€ä»¶äº‹ï¼Œå°±æ˜¯åœ¨å·¥ä½œç›®å½•é‡Œåˆ›å»º `.git` å­ç›®å½•ï¼Œå¹¶åœ¨ `.git` ç”Ÿæˆä¸€å¤§å †æ–‡ä»¶ã€‚

`.git` å°±æ˜¯ä»“åº“(repository, repo)ï¼Œå®ƒé‡Œè¾¹çš„æ–‡ä»¶éƒ½æ˜¯ git é€šè¿‡è½¯ä»¶ç”Ÿæˆçš„ï¼Œå®ƒè®°å½•äº†æ‰€æœ‰å½“å‰ç›®å½•çš„æ‰€æœ‰ç‰ˆæœ¬ä¿¡æ¯ï¼Œç”¨æˆ·åº”é¿å…ç›´æ¥ä¿®æ”¹ `.git` é‡Œçš„å†…å®¹ã€‚

è¿™äº›ç›®å½•çš„ç”¨é€”ï¼Œæˆ‘ä»¬ä¼šåœ¨è¿›é˜¶ç¯‡é‡Œæè¿°ï¼Œåˆå­¦è€…çŸ¥é“è¿™æ˜¯ git repo çš„ç³»ç»Ÿç›®å½•ä¸èƒ½æ‰‹å·¥ä¿®æ”¹å³å¯ï¼Œå¯ä»¥å…ˆä¸ç”¨äº†è§£å…·ä½“ç»†èŠ‚ã€‚

## è¿›é˜¶ç¯‡

_è¿›é˜¶ç¯‡çš„å†…å®¹åœ¨å¯¹ git æœ‰ä¸€å®šä½¿ç”¨ç»éªŒåé˜…è¯»æ›´ä½³ï¼Œåˆå­¦è€…å¯ä»¥è·³è¿‡ã€‚_

å‰é¢åŸºç¡€éƒ¨åˆ†æ˜¯ä¸€ä¸ªæ²¡æœ‰å’Œè¿œç«¯åº“å»ºç«‹è¿æ¥çš„ä¾‹å­ï¼Œè¿™é‡Œå†ä¸¾ä¸€ä¸ªå’Œè¿œç«¯åº“æœ‰è¿æ¥çš„ä¾‹å­ï¼š

```plaintext
.git
  â”œâ”€hooks
  â”œâ”€info
  â”œâ”€logs
  â”‚  â””â”€refs
  â”‚      â”œâ”€heads
  â”‚      â””â”€remotes
  â”‚          â””â”€origin
  â”œâ”€objects
  â”‚  â”œâ”€03
  â”‚  â”œâ”€..
  â”‚  â”œâ”€8b
  â”‚  â”œâ”€...
  â”‚  â”œâ”€info
  â”‚  â””â”€pack
  â””â”€refs
      â”œâ”€heads
      â”œâ”€remotes
      â”‚  â””â”€origin
      â””â”€tags
```

å¯è§æ¯”å‰é¢åŸºç¡€éƒ¨åˆ†çš„ä¾‹å­ï¼Œå¤šäº†ä¸€äº› `remotes` ç›¸å…³çš„ç›®å½•ã€‚

ä¸ºäº†æ–¹ä¾¿å®éªŒéªŒè¯ï¼Œè¿™é‡Œä½¿ç”¨æœ¬æ•™ç¨‹æ‰€åœ¨çš„ repo: <https://github.com/iridiumcao/iridiumcao.github.io>ï¼Œå¯ä»¥ clone è¿™ä¸ª repo ç»§ç»­ä¸‹é¢çš„å®éªŒã€‚

ç›®å½•æ ‘çš„æ–‡æœ¬å·²ä¸Šä¼ ï¼Œå¯ä»¥åœ¨è¿™é‡Œä¸‹è½½[tree.txt](tree.txt)ï¼Œæˆªå–è¿™ä¸ªæ–‡ä»¶çš„ç‰‡æ®µå¦‚ä¸‹ï¼š

```plaintext
.git // repo æ€»ç›®å½•
  â”‚  COMMIT_EDITMSG
  â”‚  config // é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥æ‰‹å·¥ä¿®æ”¹ï¼Œä½†ä¸å»ºè®®ã€‚å»ºè®®ä½¿ç”¨ git config æŒ‡ä»¤æ¥é…ç½®å„ç§å±æ€§
  â”‚  description // ignore it
  â”‚  FETCH_HEAD
  â”‚  HEAD
  â”‚  index
  â”‚  ORIG_HEAD
  â”‚  packed-refs
  â”‚  
  â”œâ”€hooks // å„ç§å„æ ·çš„ hook, ç”¨ä»¥ç²¾ç»†æ§åˆ¶ git è¡Œä¸ºï¼Œæ¯”å¦‚å¯¹ commit's comment åšæ£€æŸ¥ç­‰ï¼Œç”¨çš„æ—¶å€™æŠŠæ–‡ä»¶åçš„åç¼€åå»æ‰ï¼Œå¹¶å†™ä¸Šè‡ªå·±çš„è„šæœ¬å³å¯
  â”‚      applypatch-msg.sample
  â”‚      commit-msg.sample
  â”‚      ... // (ignore some)
  â”‚      
  â”œâ”€info
  â”‚      exclude
  â”‚      refs
  â”‚      
  â”œâ”€logs
  â”‚  â”‚  HEAD
  â”‚  â”‚  
  â”‚  â””â”€refs
  â”‚      â”‚  stash
  â”‚      â”‚  
  â”‚      â”œâ”€heads
  â”‚      â”‚      git-tutorial
  â”‚      â”‚      master
  â”‚      â”‚      
  â”‚      â””â”€remotes
  â”‚          â””â”€origin
  â”‚                  git-tutorial
  â”‚                  HEAD
  â”‚                  master
  â”‚                  
  â”œâ”€objects // æ¯æ¬¡æäº¤çš„å†…å®¹ï¼Œgit ä¼šæ‰“åŒ…æˆä¸€ä¸ªä¸€ä¸ªå—(block)ï¼Œé€šè¿‡ hash tree å°†å®ƒä»¬ä¸²èµ·æ¥ã€‚æ³¨æ„ï¼Œä¸€æ¬¡æäº¤å¯èƒ½ç”Ÿæˆå¤šä¸ªå—ã€‚
  â”‚  â”œâ”€03
  â”‚  â”‚      36a86bf41227b99a5b0ff536e3d2eb9bb27c77
  â”‚  â”‚      c8ebdc379d8ee891fa71e4f8f278d88b76df91
  â”‚  â”‚      
  â”‚  â”œâ”€... // (ignore many)
  â”‚  â”‚      
  â”‚  â”œâ”€8b
  â”‚  â”‚      722e84228b2cb2cc903c671252d8458632ff0d
  â”‚  â”‚      a3e3236accfc651ad07957ac186a724f11324a
  â”‚  â”‚      
  â”‚  â”œâ”€... // (ignore many)
  â”‚  â”‚      
  â”‚  â”œâ”€info
  â”‚  â”‚      commit-graph
  â”‚  â”‚      packs
  â”‚  â”‚      
  â”‚  â””â”€pack
  â”‚          pack-85a82d35e06ea1e2e621d225a640bf3d92bc1f29.idx
  â”‚          pack-85a82d35e06ea1e2e621d225a640bf3d92bc1f29.pack
  â”‚          
  â””â”€refs
      â”‚  stash
      â”‚  
      â”œâ”€heads // branch çš„ä¿¡æ¯ï¼Œè®°å½•æœ¬åœ°åº“ä¸­å„ä¸ª branch çš„ hash
      â”‚      git-tutorial  // branch git-tutorial çš„ hash
      â”‚      master
      â”‚      
      â”œâ”€remotes // è¿œç«¯ repo çš„é›†åˆ
      â”‚  â””â”€origin // è¿œç«¯åº“ origin çš„ repo
      â”‚          git-tutorial // è®°å½•è¿œç«¯ branch git-tutorial çš„ hash
      â”‚          HEAD
      â”‚          master
      â”‚          
      â””â”€tags // tag çš„ä¿¡æ¯ï¼Œè®°å½•æœ¬åœ°åº“ä¸­å„ä¸ª tag çš„ hashï¼Œå½“å‰ repo æ²¡æœ‰æ‰“ tagï¼Œæ‰€ä»¥ç›®å½•æ—¶ç©ºçš„ã€‚
```

æœ¬æ•™ç¨‹çš„ç¬¬ä¸€ä¸ª commit çš„å…ƒä¿¡æ¯å¦‚å›¾æ‰€ç¤ºï¼š

![](images/ch05_02_commit_details.png)

å®ƒçš„ commit id æ˜¯ 8ba3e3236accfc651ad07957ac186a724f11324a

å¯¹åº”çš„æ–‡ä»¶å°±æ˜¯ `.git/objects/8b/a3e3236accfc651ad07957ac186a724f11324a`

objects ç›®å½•é‡Œå­˜æ”¾äº†å…¨éƒ¨çš„æ”¹åŠ¨ä¿¡æ¯ï¼Œä¸ºäº†é¿å…åŒä¸€ä¸ªç›®å½•æ–‡ä»¶å¤ªå¤šï¼Œå®ƒæŠŠ commit id çš„å‰ä¸¤ä½å­—ç¬¦ç”¨æ¥åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè¿™æ ·å°±èƒ½å°†å¤§é‡commitåˆ†æ•£åˆ°ä¸åŒçš„æ–‡ä»¶å¤¹ä¸­ã€‚

### å®éªŒæç¤º

å¦‚æœæƒ³è¦å¤ç°ä¸Šé¢çš„å®éªŒï¼Œå¯ä»¥è¿™ä¹ˆåšï¼š

#### 1. å– commit id

é€šè¿‡ `git log` æ‰¾åˆ°ä»»æ„ä¸€ä¸ª commitï¼Œè®°ä¸‹å®ƒçš„ id. 

æˆ‘å‰é¢ä¸“é—¨æ‰¾åˆ°äº†æœ¬æ•™ç¨‹çš„ç¬¬ä¸€ä¸ª commitï¼Œå–å®ƒçš„ id 8ba3e3236accfc651ad07957ac186a724f11324a æ¥ç”¨ã€‚

è¿™ä¸ª commit çš„å…ƒä¿¡æ¯å¦‚ä¸‹ï¼š

```plaintext
$ git cat-file -p 8ba3e3236accfc651ad07957ac186a724f11324a
tree 0441ae470a6225462a16a0f1b8f15d7c38cdd9d5
parent 38501b46228d68991273965cc7447698cba33c81
author Cao Yi <iridiumcao@gmail.com> 1701778161 +0800
committer Cao Yi <iridiumcao@gmail.com> 1701778161 +0800

git's born
```

(git-cat-file - Provide content or type and size information for repository objects)

#### 2. æŸ¥æ‰¾å¯¹åº”çš„æ–‡ä»¶

æ¯ä¸€ä¸ª commit åœ¨ `.git/objects` ç›®å½•é‡Œéƒ½èƒ½æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶ã€‚
è¿™ä¸ªæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•æ˜¯ `.git/objects/{commit id çš„å‰ä¸¤ä½}`ï¼Œæ–‡ä»¶åæ˜¯ commit id æˆªå»å‰ä¸¤ä½å‰©ä¸‹çš„å­—ä¸²ã€‚

å‰é¢å·²æåˆ°è¿‡ 8ba3e3236accfc651ad07957ac186a724f11324a å¯¹åº”çš„æ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„æ˜¯ï¼š`.git/objects/8b/a3e3236accfc651ad07957ac186a724f11324a`

éªŒè¯ã€‚å‰é¢å·²ç»æœ‰äº†[tree.txt](tree.txt), å¯ä»¥æ‰“å¼€å®ƒï¼Œç›´æ¥æœ a3e3236accfc651ad07957ac186a724f11324a

![](images/ch05_03_commit_object.png)

ï¼ˆæœ¬æ–‡å‰é¢å·²ç»æˆªå–è¿‡è¿™ä¸ªç›®å½•æ ‘ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨æœ¬ç½‘é¡µä¸Šæœ a3e3236accfc651ad07957ac186a724f11324aï¼‰

å¦‚æœå–œæ¬¢è‡ªå·±åŠ¨æ‰‹ï¼Œå°±ç›´æ¥åˆ° `.git/objects` ç›®å½•ä¸‹å»æŸ¥æ‰¾ä¹Ÿè¡Œã€‚

å‚è€ƒï¼š[é€šè¿‡ .git ç›®å½•æ·±å…¥ç†è§£ Gitï¼](https://zhuanlan.zhihu.com/p/106243588)

---

[â‡¦ä¸Šä¸€ç« ](04.md) - [é¦–é¡µğŸ ](index.md) - [ä¸‹ä¸€ç« â‡¨](06.md)