# ç¬¬å…«ç«  åˆ†æ”¯(Branch)

[â‡¦ä¸Šä¸€ç« ](07.md) - [é¦–é¡µğŸ ](index.md) - [ä¸‹ä¸€ç« â‡¨](09.md)

---

- [ç¬¬å…«ç«  åˆ†æ”¯(Branch)](#ç¬¬å…«ç« -åˆ†æ”¯branch)
  - [1. æŸ¥çœ‹å½“å‰åˆ†æ”¯](#1-æŸ¥çœ‹å½“å‰åˆ†æ”¯)
  - [2. åˆ›å»ºåˆ†æ”¯](#2-åˆ›å»ºåˆ†æ”¯)
  - [3. åˆ‡æ¢åˆ†æ”¯](#3-åˆ‡æ¢åˆ†æ”¯)
  - [4. é‡å‘½ååˆ†æ”¯](#4-é‡å‘½ååˆ†æ”¯)
  - [5. åˆ é™¤åˆ†æ”¯(delete)](#5-åˆ é™¤åˆ†æ”¯delete)
  - [6. åˆå¹¶åˆ†æ”¯(merge)](#6-åˆå¹¶åˆ†æ”¯merge)
    - [6.1 å®éªŒæ¦‚è¿°](#61-å®éªŒæ¦‚è¿°)
    - [6.2 åˆ›å»ºæ–°çš„åˆ†æ”¯](#62-åˆ›å»ºæ–°çš„åˆ†æ”¯)
    - [6.3 åˆå¹¶(Merge)](#63-åˆå¹¶merge)
    - [6.4 è§£å†³å†²çª(Resolve Conflicts)](#64-è§£å†³å†²çªresolve-conflicts)
    - [6.5 åœ¨åˆå¹¶åçš„ master ä¸Šç»§ç»­æ·»åŠ ç‰ˆæœ¬](#65-åœ¨åˆå¹¶åçš„-master-ä¸Šç»§ç»­æ·»åŠ ç‰ˆæœ¬)
    - [6.6 è¿‡ç¨‹æ€»ç»“](#66-è¿‡ç¨‹æ€»ç»“)
  - [7. å˜åŸº(rebase)](#7-å˜åŸºrebase)
    - [7.1 å®éªŒæ¦‚è¿°](#71-å®éªŒæ¦‚è¿°)
    - [7.2 å˜åŸºæ“ä½œ](#72-å˜åŸºæ“ä½œ)
  - [8. Cherry-pick](#8-cherry-pick)
    - [8.1 å®éªŒè®°å½•](#81-å®éªŒè®°å½•)
    - [8.2 å…·ä½“æ“ä½œ](#82-å…·ä½“æ“ä½œ)
  - [9. è¿›é˜¶ç¯‡](#9-è¿›é˜¶ç¯‡)
    - [9.1 å¼ºåˆ¶åˆ‡æ¢åˆ†æ”¯](#91-å¼ºåˆ¶åˆ‡æ¢åˆ†æ”¯)
    - [9.2 æ£€æŸ¥ä¸€ä¸ª commit å·²ç»åŒ…å«åœ¨å“ªäº› branch ä¸­](#92-æ£€æŸ¥ä¸€ä¸ª-commit-å·²ç»åŒ…å«åœ¨å“ªäº›-branch-ä¸­)
    - [9.3 ä¸¤ç§åˆ é™¤çš„ä¸åŒ](#93-ä¸¤ç§åˆ é™¤çš„ä¸åŒ)
    - [9.4 main VS master](#94-main-vs-master)
    - [9.5 `checkout` VS `switch`](#95-checkout-vs-switch)
    - [9.6 åˆå¹¶çš„ä¸‰ç§æ¨¡å¼](#96-åˆå¹¶çš„ä¸‰ç§æ¨¡å¼)
      - [9.6.1 `--ff`](#961---ff)
      - [9.6.2 `--no-ff`](#962---no-ff)
      - [9.6.3 `--ff-only`](#963---ff-only)
      - [9.6.4 å°ç»“](#964-å°ç»“)

---

åˆ†æ”¯(Branch)å°±æ˜¯ä¸åŒçš„ç‰ˆæœ¬ç³»åˆ—ã€‚æ¯”å¦‚ä» V3 å¼€å§‹ï¼Œå¼ ä¸‰ç»§ç»­ä¿®æ”¹ï¼Œå¹¶å‘å±•å‡º Va4, Va5, ..., æå››ä¹Ÿæ˜¯ä» V3 å¼€å§‹ä¿®æ”¹ï¼Œå¹¶å‘å±•å‡º Vb4, Vb5, ..., è¿˜æœ‰ç‹äº”èµµå…­ç­‰ç­‰çš„æ”¹åŠ¨ã€‚å®ƒä»¬éƒ½æœ‰å„è‡ªçš„ç‰ˆæœ¬ç³»åˆ—ï¼Œå³åˆ†æ”¯ã€‚

![](images/ch08_01_branches.png)

å¦‚ä¸Šå›¾ï¼Œ

* Branch Zhang San: V1 â†’ V2 â†’ V3 â†’ Va4 â†’ Va5
* Branch Li Si: V1 â†’ V2 â†’ V3 â†’ Vb4 â†’ Vb5 â†’ Vb6
* Another Branch 1: V1 â†’ V2 â†’ Vc3 â†’ Vc4 â†’ ...
* Another Branch 2: V1 â†’ V2 â†’ Vc3 â†’ Vc4 â†’ Vd6 â†’ ...

Git Repo å…¨éƒ¨ commit æ„æˆäº†ä¸€æ£µæ ‘ï¼ŒGit Repo çš„ä¸€ä¸ªç‰ˆæœ¬å°±æ˜¯æ ‘ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹(node), ä¸€ä¸ªåˆ†æ”¯å°±æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°æŸä¸ªå­èŠ‚ç‚¹çš„è·¯å¾„ã€‚ä¸€ä¸ªåˆ†æ”¯å¯ä»¥åˆå¹¶åˆ°å¦ä¸€ä¸ªåˆ†æ”¯ä¸Šã€‚

ä¹‹å‰çš„å‡ ç« çš„æ‰€æœ‰æ“ä½œå…¶å®ä¹Ÿåœ¨ä¸€ä¸ªåˆ†æ”¯ä¸Šï¼Œå³ master åˆ†æ”¯ã€‚

å‡ ä¹æ‰€æœ‰ VCS éƒ½æœ‰åˆ†æ”¯åŠŸèƒ½ï¼Œä½† Git çš„åˆ†æ”¯éå¸¸è½»é‡ï¼Œéå¸¸å®¹æ˜“ä½¿ç”¨ï¼Œè¿™å¾—ç›Šäºå®ƒçš„å¯¹è±¡æ ‘è®¾è®¡ã€‚ä»æœ¬ç« å¼€å§‹ï¼Œæˆ‘ä»¬å°†å­¦ä¹ æ›´å¤šå…³äºåˆ†æ”¯çš„çŸ¥è¯†ã€‚

## 1. æŸ¥çœ‹å½“å‰åˆ†æ”¯

å¯ä½¿ç”¨ `git branch`(ä¸å¸¦å‚æ•°)åˆ—ä¸¾å½“å‰çš„åˆ†æ”¯åˆ—è¡¨ï¼Œä¾‹å¦‚ï¼š

```plaintext
$ git branch
* git-tutorial
  ipfs
  java
  master
```

å…¶ä¸­åŠ æ˜Ÿå·è¡¨ç¤ºå½“å‰æ‰€åœ¨çš„åˆ†æ”¯ã€‚`git-tutorial` åˆ†æ”¯å°±æ˜¯æˆ‘å½“å‰å†™æœ¬æ•™ç¨‹çš„åˆ†æ”¯ã€‚è¿™æ˜¯æˆ‘æœ¬åœ°çš„ä¸€ä¸ª Git Repo çš„åˆ†æ”¯æƒ…å†µï¼Œå¦‚æœä½ ä»å‰é¢çš„æ•™ç¨‹çœ‹èµ·ï¼Œä½ åœ¨æ‰§è¡Œ `git branch` å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š

```plaintext
$ git branch
* master
```

æˆ–

```plaintext
$ git branch
* main
```

åˆšåˆšåˆ›å»ºçš„ç©ºåº“(Empty Repository)çš„åˆ†æ”¯åˆ—è¡¨ä¹Ÿä¸ºç©ºã€‚ä¸‹é¢ä¸€èŠ‚æˆ‘ä»¬å°†æ¼”ç¤ºåˆ›å»ºæ›´å¤šåˆ†æ”¯ã€‚

## 2. åˆ›å»ºåˆ†æ”¯

ä»æŸä¸ªèŠ‚ç‚¹(ç‰ˆæœ¬)åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ï¼Œåœ¨ master åˆ†æ”¯ä¸Šæ‰§è¡Œä¸‹é¢çš„æ“ä½œï¼š

```plaintext
$ git branch hello
$ git branch
  hello
* master
```

åˆ†æ”¯åˆ›å»ºå¥½åï¼Œå¯ä»¥é€šè¿‡ `git branch` æŸ¥çœ‹åˆ—è¡¨æ‰¾åˆ°ã€‚ä½† HEAD ä»ç„¶åœ¨å½“å‰åˆ†æ”¯ï¼Œä¸ä¼šåˆ‡æ¢åˆ°æ–°åˆ†æ”¯ä¸Šã€‚ç©ºåº“ä¸Šæ— æ³•ä½¿ç”¨è¿™ä¸ªæŒ‡ä»¤ã€‚

å¦‚æœè¦åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æ–°åˆ†æ”¯ï¼Œå¯ç”¨ `git switch -c {branch name}`ï¼Œåœ¨ master åˆ†æ”¯ä¸Šæ‰§è¡Œä¸‹é¢çš„æ“ä½œï¼š

```plaintext
$ git switch -c hello
Switched to a new branch 'hello'
$ git branch
* hello
  master
```

`git switch -c {branch name}` åœ¨å½“å‰åˆ†æ”¯çš„ä»£ç ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼Œå¹¶åˆ‡æ¢åˆ°æ–°çš„åˆ†æ”¯ã€‚è¿™æ¡æŒ‡ä»¤ç›¸å½“äº `git branch {branch name}`, `git switch {branch name}` ä¸¤æ¡æŒ‡ä»¤çš„ç»„åˆã€‚æ–°åˆ†æ”¯åˆ›å»ºæ—¶æ‰€åœ¨çš„é‚£ä¸ª commit å°±æ˜¯åˆ†æ”¯åˆ†å‰çš„èŠ‚ç‚¹ã€‚

## 3. åˆ‡æ¢åˆ†æ”¯

å¯ä½¿ç”¨ `git switch {branch name}`ã€‚ä¾‹å¦‚ï¼š

```plaintext
$ git switch hello
Switched to branch 'hello'
```

## 4. é‡å‘½ååˆ†æ”¯

Git æ²¡æœ‰ `rename` è¿™ä¸ªæŒ‡ä»¤ï¼Œä½†å®ƒé‡‡ç”¨äº†å˜é€šæ–¹æ³•ï¼š`move`

æŸ¥çœ‹ç°åœ¨æ‰€åœ¨çš„åˆ†æ”¯ï¼š

```plaintext
$ git branch
* hello
  master
```

ç§»åŠ¨åˆ†æ”¯(`git branch --move {new branch name}`)ï¼š

```plaintext
$ git branch --move hello-moved
```

å†æŸ¥åˆ†æ”¯åˆ—è¡¨ï¼š

```plaintext
$ git branch
* hello-moved
  master
```

å¯è§åˆ†æ”¯åç§°å·²ç»ç”± `hello` å˜æˆäº† `hello-moved`.

## 5. åˆ é™¤åˆ†æ”¯(delete)

æŒ‡ä»¤ï¼š`git branch -D {branch name}`

ã€å®éªŒè¿‡ç¨‹ã€‘

æŸ¥çœ‹å½“å‰åˆ†æ”¯åˆ—è¡¨ï¼š

```plaintext
$ git branch
* hello-moved
  master
```

åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æ–°åˆ†æ”¯ `hello`ï¼š

```plaintext
$ git switch -c hello
Switched to a new branch 'hello'
```

å†æŸ¥åˆ†æ”¯æƒ…å†µï¼š

```plaintext
$ git branch
* hello
  hello-moved
  master
```

åˆ æ‰åˆ†æ”¯ `hello-moved`:

```plaintext
$ git branch -D hello-moved
Deleted branch hello-moved (was 730e097).
```

å†æŸ¥åˆ†æ”¯æƒ…å†µï¼š

```plaintext
$ git branch
* hello
  master
```

å¯è§åˆ†æ”¯çœŸçš„åˆ é™¤äº†ï¼Œè¿™é‡Œé€šè¿‡å¤šä¸ªæ­¥éª¤ä¹Ÿå®ç°äº† `git branch --move` çš„æ“ä½œï¼Œå®é™…å·¥ä½œå’Œå­¦ä¹ ä¸­åº”è¯¥é€‰ç”¨æ›´æ–¹ä¾¿çš„æ–¹å¼ï¼Œè¿™é‡Œä»…ä½œæ¼”ç¤ºã€‚è¿™ä¹Ÿè¯´æ˜ git çš„æŒ‡ä»¤éå¸¸çµæ´»ï¼Œå¯ä»¥é€šè¿‡ä¸åŒçš„æ–¹æ³•å®ŒæˆåŒæ ·çš„ç›®æ ‡ã€‚

## 6. åˆå¹¶åˆ†æ”¯(merge)

```plaintext
    o---o---o---o---o---o---o---o---o---o---o  master
  root       \             /
              o---o---o---o  feature
```

å¦‚ä¸Šå›¾ feature åˆ†æ”¯ä»ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹å¼€å§‹åˆ†å‰ï¼Œåˆ°ç¬¬ä¸ƒä¸ªèŠ‚ç‚¹åˆ**åˆå¹¶**åˆ° master ä¸Šã€‚

* `git merge {branch name}` æŠŠæŸåˆ†æ”¯çš„ä»£ç åˆå¹¶åˆ°å½“å‰åˆ†æ”¯
* `git merge {branch name} --no-ff` æŠŠæŸåˆ†æ”¯çš„ä»£ç åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ï¼ŒåŒæ—¶æ— è®ºå¦‚ä½•éƒ½è®°å½•åˆå¹¶ç—•è¿¹

### 6.1 å®éªŒæ¦‚è¿°

_(å®éªŒç”¨çš„ repo å¯ä»¥åœ¨[è¿™é‡Œä¸‹è½½](test_repo.7z)ï¼Œå†…å« master åˆ†æ”¯ï¼Œå·²æœ‰äº”ä¸ª commit)_

ä» V3 å¼€å§‹å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼Œå†é€ ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œç„¶ååˆå¹¶åˆ° master çš„ V5 ä¸Šï¼Œåˆå¹¶åï¼Œå†é€ ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œæœ€ç»ˆæ•ˆæœå¦‚å›¾æ‰€ç¤º

```plaintext
   v1---v2---v3---v4---v5---v8---v9    master
  root        \       /
               v6---v7                 feature
```

ä¸‹é¢æ˜¯å®éªŒçš„å…·ä½“è¿‡ç¨‹

### 6.2 åˆ›å»ºæ–°çš„åˆ†æ”¯

```plaintext
$ git log --pretty=oneline
72f439c53b36063b5a90c4cdd9c950c1bda5878c (HEAD -> master) Version 5
2e760674a969439479ede654d69e5c0b5a806c96 Version 4
aeaefe37457aa32a4d5c5518f672f1604b461c37 Version 3
8ef2f2fa9f00daa5635dfb269bc8f618635d0fa4 Version 2
733a7c97f6f6845e0b636d562855ad297b2d9db2 Version 1
```

ç”¨ `git checkout {commit hash} -b {branch name}` ä» V3 (aeaefe37) å¼€å§‹åˆ›å»ºæ–°çš„åˆ†æ”¯ feature:

```plaintext
$ git checkout aeaefe37 -b feature
Switched to a new branch 'feature'
```

æŸ¥çœ‹åˆ†æ”¯åˆ—è¡¨ï¼š

```plaintext
$ git branch
* feature
  master
```

æ¥ä¸‹æ¥éšä¾¿æ”¹ç‚¹ä¸œè¥¿ï¼Œåšä¸¤æ¬¡æäº¤ (åˆ›å»ºä¸¤ä¸ªæ–°çš„ç‰ˆæœ¬)ï¼š

```plaintext
$ ls
hello.txt  hello2.txt

$ echo "hello, v6" >> hello.txt
$ echo "hello, v6" >> hello2.txt
$ git add .
$ git commit -m "Version 6"
[feature d08dfb0] Version 6
 2 files changed, 2 insertions(+)


$ echo "hello, v7" >> hello.txt
$ echo "hello, v7" >> hello2.txt
$ git add .
$ git commit -m "Version 7"
[feature 8aba717] Version 7
 2 files changed, 2 insertions(+)
```

å½“å‰çš„ git repo çš„æ‰€æœ‰ branch åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š

```plaintext
   v1---v2---v3---v4---v5      master
  root        \ 
               v6---v7         feature
```

å¯ä»¥ç”¨ GUI å·¥å…· [Git Extensions](16.md) æŸ¥çœ‹ï¼š

![](images/ch08_02_merge.png)

èƒ½å¾ˆæ¸…æ¥šçœ‹åˆ° branch ä» V3 å¼€å§‹åˆ†å‰ï¼Œä¸€ä¸ªåˆ†æ”¯æ˜¯ `master`, å¦ä¸€ä¸ªæ˜¯ `feature`.

### 6.3 åˆå¹¶(Merge)

ç°åœ¨å›åˆ° `master` å¹¶æŠŠ `feature` çš„æ”¹åŠ¨ V6 å’Œ V7 åˆå¹¶è¿›æ¥ã€‚

```plaintext
$ git switch master
$ git merge feature
```

å¾ˆé—æ†¾ï¼Œå‡ºç°äº†ä»£ç å†²çª(conflicts).

æ³¨æ„çœ‹å±å¹•æç¤ºè¯­ï¼Œå¦‚æƒ³æ”¾å¼ƒï¼Œå¯ä»¥æ‰§è¡Œ `git merge --abort`.

![](images/ch08_03_merge_conflicts.png)

### 6.4 è§£å†³å†²çª(Resolve Conflicts)

ä¾æ® git çš„ç•Œé¢æç¤ºï¼Œhello2.txt åœ¨ master ä¸Šå·²ç»åˆ é™¤äº†ï¼Œé‚£æˆ‘ä¹ˆè¿™æ¬¡å°±æŒ‰ master æŠŠå®ƒåˆ äº†å§ã€‚æ³¨æ„å†²çªçš„å¤„ç†æ–¹å¼æ˜¯æ ¹æ®å…·ä½“çš„éœ€æ±‚æ¥å®šçš„ï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä¿ç•™ hello2.txt.

```plaintext
$ git rm hello2.txt
rm 'hello2.txt'

$ git merge --continue
[master 219ef32] Merge branch 'feature'
```

![](images/ch08_04_merge.png)

æˆ‘è¿™é‡Œæ‰§è¡Œäº† `git merge --continue`ï¼Œå®é™…ä¸ŠæŒ‰ç…§æç¤ºæ‰§è¡Œ `git commit` ä¹Ÿè¡Œï¼Œgit çš„æŒ‡ä»¤å¾ˆçµæ´»ï¼Œè¯¸å‡ºåŒå½’ã€‚è¿™å¥æ‰§è¡Œåï¼Œä¼šå¼¹å‡ºä¸€ä¸ª message ç¼–è¾‘ç•Œé¢ï¼Œç”¨æ¥ç¼–è¾‘åˆå¹¶èŠ‚ç‚¹çš„ message.

![](images/ch08_06_merge.png)

æ‰©å±•é˜…è¯»ï¼š[Who are "us" and "them"?](us_them.md)

### 6.5 åœ¨åˆå¹¶åçš„ master ä¸Šç»§ç»­æ·»åŠ ç‰ˆæœ¬

```plaintext
$ ls
hello.txt

$ echo "hello v8">> hello.txt
$ git add .
$ git commit -m "Version 8"

$ echo "hello v9">> hello.txt
$ git add .
$ git commit -m "Version 9"
```

æœ€ååˆ†æ”¯å‘ˆç°çš„æ ·å­å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](images/ch08_05_merge.png)

å¦‚æœæ–°åˆ†æ”¯ feature ä» V5 å¼€å§‹ï¼Œé‚£ä¹ˆ master åˆå¹¶åï¼Œæ˜¯ä¸ä¼šæœ‰åˆå¹¶èŠ‚ç‚¹(219ef32f)çš„ã€‚ä½† `--no-ff` å‚æ•°ä¼šå¼ºåˆ¶åˆ›å»ºåˆå¹¶èŠ‚ç‚¹ã€‚

### 6.6 è¿‡ç¨‹æ€»ç»“

HEAD æŒ‡å‘ç›®æ ‡åˆ†æ”¯ï¼Œå³è¦åˆå¹¶åˆ«çš„åˆ†æ”¯çš„åˆ†æ”¯ï¼Œä¾‹å¦‚åœ¨ master ä¸Šæ‰§è¡Œ `git merge feature`ï¼Œä¼šå°† feature åˆ†æ”¯ä¸Šçš„æ”¹åŠ¨åˆå¹¶åˆ° master åˆ†æ”¯ä¸Šã€‚å¦‚æœåˆå¹¶å¤±è´¥ï¼Œå‡ºç°å†²çªï¼Œå¯ä»¥åœ¨ master ä¸Šæ‰‹åŠ¨ä¿®æ”¹æ–‡ä»¶ï¼Œå†åœ¨ master ä¸Šæäº¤å³å¯ã€‚

## 7. å˜åŸº(rebase)

ã€Œå˜åŸºã€çš„ä¸­æ–‡å«ä¹‰å®¹æ˜“è¯¯è§£ğŸ˜€ï¼Œä¸è¿‡å¯èƒ½ä¸æ˜¯ä½ æƒ³çš„é‚£ä¸ªæ„æ€ï¼Œå®ƒçš„å…¨ç§°å¯ä»¥ç†è§£ä¸ºã€Œæ”¹å˜åŸºç¡€ã€, rebase ä¸€è¯ä¹Ÿè¦åˆ†è§£ä¸º re-base å°±å¥½ç†è§£äº†ã€‚

è¿˜æ˜¯ä»¥å‰é¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬ä» V3 å¼€å§‹ï¼Œåˆ›å»ºäº†æ–°çš„ branch featureï¼Œè¿™ä¸ªæ–° branch å°±æ˜¯ä»¥ V3 ä¸ºã€ŒåŸº(base)ã€çš„ã€‚æˆ‘ä»¬æ–°å¢ä¸¤ä¸ª commit ä¹‹åï¼Œæƒ³æŠŠ feature åˆ†æ”¯æ”¹æˆ(re)ä»¥ V5 ä¸ºã€ŒåŸº(base)ã€ï¼Œè¿™å°±æ˜¯å˜åŸºã€‚

æœ¬æ¥æ˜¯è¿™æ ·çš„ï¼š

```plaintext
   v1---v2---v3---v4---v5         master
  root        \ 
               v6---v7            feature
```

ä½†æˆ‘ä»¬æƒ³æ”¹æˆè¿™æ ·çš„ï¼š

```plaintext
   v1---v2---v3---v4---v5           master
  root                  \ 
                         v6---v7    feature
```

è¿™å°±æ˜¯ã€Œå˜åŸº(rebase)ã€

### 7.1 å®éªŒæ¦‚è¿°

_(å®éªŒç”¨çš„ repo å¯ä»¥åœ¨[è¿™é‡Œä¸‹è½½](test_repo.7z)ï¼Œå†…å« master åˆ†æ”¯ï¼Œå·²æœ‰äº”ä¸ª commit)_

å’Œä¸Šä¸€èŠ‚çš„å®éªŒä¸€æ ·ï¼Œå…ˆåˆ›å»ºæ–°åˆ†æ”¯ featureï¼Œå¹¶åˆ›å»ºä¸¤ä¸ªæ–°çš„æäº¤ã€‚æŒ‰[6.2 åˆ›å»ºæ–°çš„åˆ†æ”¯](#62-åˆ›å»ºæ–°çš„åˆ†æ”¯)å†èµ°ä¸€éå°±è¡Œã€‚å¦‚æœ6çš„å®éªŒå·²ç»åšå®Œï¼Œå¯ä»¥åœ¨ master åˆ†æ”¯ä¸Šç›´æ¥ç”¨ `reset` æŒ‡ä»¤åˆ° V5(72f439c5) ä¹Ÿå¯ã€‚

```plaintext
$ git reset --hard 72f439c5
HEAD is now at 72f439c Version 5
```

ç°åœ¨çš„ commit æ ‘æ˜¯è¿™æ ·çš„

![](images/ch08_07_rebase.png)

### 7.2 å˜åŸºæ“ä½œ

åˆ‡æ¢åˆ° feature åˆ†æ”¯ä¸Šå¼€å§‹å˜åŸºï¼š

```plaintext
$ git switch feature
$ git rebase master
CONFLICT (modify/delete): hello2.txt deleted in HEAD and modified in d08dfb0 (Version 6).  Version d08dfb0 (Version 6) of hello2.txt left in tree.
error: could not apply d08dfb0... Version 6
hint: Resolve all conflicts manually, mark them as resolved with
hint: "git add/rm <conflicted_files>", then run "git rebase --continue".
hint: You can instead skip this commit: run "git rebase --skip".
hint: To abort and get back to the state before "git rebase", run "git rebase --abort".
Could not apply d08dfb0... Version 6
```

![](images/ch08_08_rebase.png)

_(æ³¨æ„çœ‹å±å¹•æç¤ºè¯­ï¼Œå¦‚æƒ³æ”¾å¼ƒå˜åŸºæ“ä½œï¼Œå¯ä»¥æ‰§è¡Œ `git rebase --abort`)_

ä¸å¹¸é‡åˆ°ä»£ç å†²çªï¼Œä¸è¦æ…Œï¼Œç”¨ `git status` çœ‹ä¸‹ï¼Œå†æ‰‹å·¥å¤„ç†

```plaintext
$ git status
interactive rebase in progress; onto 72f439c
Last command done (1 command done):
   pick d08dfb0 Version 6
Next command to do (1 remaining command):
   pick 8aba717 Version 7
  (use "git rebase --edit-todo" to view and edit)
You are currently rebasing branch 'feature' on '72f439c'.
  (fix conflicts and then run "git rebase --continue")
  (use "git rebase --skip" to skip this patch)
  (use "git rebase --abort" to check out the original branch)

Changes to be committed:
  (use "git restore --staged <file>..." to unstage)
        modified:   hello.txt

Unmerged paths:
  (use "git restore --staged <file>..." to unstage)
  (use "git add/rm <file>..." as appropriate to mark resolution)
        deleted by us:   hello2.txt
```

![](images/ch08_09_rebase.png)

ä¾æ® git çš„ç•Œé¢æç¤ºï¼Œhello2.txt åœ¨ master ä¸Šå·²ç»åˆ é™¤äº†ï¼Œé‚£æˆ‘ä¹ˆè¿™æ¬¡å°±æŒ‰ master æŠŠå®ƒåˆ äº†å§ã€‚æ³¨æ„å†²çªçš„å¤„ç†æ–¹å¼æ˜¯æ ¹æ®å…·ä½“çš„éœ€æ±‚æ¥å®šçš„ï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä¿ç•™ hello2.txt.

```plaintext
iridi@hpyi MINGW64 ~/sandbox/temp/test_repo10_1 (feature|REBASE 1/2)
$ git rm hello2.txt
rm 'hello2.txt'
```

å†çœ‹çœ‹ç°åœ¨çš„çŠ¶æ€ï¼š

```plaintext
iridi@hpyi MINGW64 ~/sandbox/temp/test_repo10_1 (feature|REBASE 1/2)
$ git status
interactive rebase in progress; onto 72f439c
Last command done (1 command done):
   pick d08dfb0 Version 6
Next command to do (1 remaining command):
   pick 8aba717 Version 7
  (use "git rebase --edit-todo" to view and edit)
You are currently rebasing branch 'feature' on '72f439c'.
  (all conflicts fixed: run "git rebase --continue")

Changes to be committed:
  (use "git restore --staged <file>..." to unstage)
        modified:   hello.txt
```

![](images/ch08_10_rebase.png)

æŒ‰æç¤ºï¼Œå†²çªè§£å†³äº†ï¼Œå¯ä»¥ç”¨ `git rebase --continue` ç»§ç»­ï¼Œæ¥ä¸‹æ¥åˆæœ‰ä¸€ä¸ªå†²çªï¼Œæ²¡å…³ç³»ï¼ŒæŒ‰ç±»ä¼¼çš„æ–¹å¼è§£å†³å°±è¡Œï¼š

1. `git status` æŸ¥çœ‹å†²çªçš„æ–‡ä»¶åˆ—è¡¨ï¼Œæœ‰å†²çªçš„æ–‡ä»¶ä¼šæ”¾åˆ°å·¥ä½œåŒº(Working Directory)é‡Œ
2. æ‰‹å·¥å¤„ç†è¿™äº›æœ‰å†²çªçš„æ–‡ä»¶
3. å¤„ç†å®Œæ¯•åï¼Œç”¨ `git add` æŒ‡ä»¤æŠŠå®ƒä»¬ä»å·¥ä½œåŒºå­˜æ”¾åˆ°ç¼“å­˜åŒº(Staging Area)
4. æ‰§è¡Œ `git rebase --continue` å³å¯ã€‚å®Œæ¯•ã€‚

å¤„ç†å®Œæ¯•ï¼Œfeature åˆ†æ”¯æ˜¯è¿™æ ·çš„ï¼š

![](images/ch08_11_rebase.png)

æ‰§è¡Œå˜åŸº(rebase)æ“ä½œåï¼ŒåŸº(base)å˜äº†çš„èŠ‚ç‚¹çš„ hash ä¼šå˜ã€‚

## 8. Cherry-pick

åˆå¹¶(merge)ä¼šæŠŠä¸€ä¸ªåˆ†æ”¯çš„å…¨éƒ¨æ”¹åŠ¨å¼•å…¥åˆ°å½“å‰åˆ†æ”¯ï¼Œä½†æœ‰æ—¶æˆ‘ä»¬åªéœ€è¦æŸä¸ªåˆ†æ”¯çš„å‡ ä¸ª commitï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦è¿™æ ·çš„æ“ä½œï¼šå°†å¯¹æ–¹çš„ commit æŠ“è¿‡æ¥ï¼Œå¹¶æ¥åœ¨å½“å‰çš„åˆ†æ”¯ä¸Šã€‚è¿™ç§ä»å…¶ä»–åˆ†æ”¯æŒ‘é€‰ commit, æŠ“å–å¹¶æ¥å…¥å½“å‰åˆ†æ”¯çš„æ“ä½œï¼Œå°±å« cherry-pick.

æ¯”å¦‚å½“å‰çš„ commit tree æ˜¯è¿™æ ·çš„ï¼š

```plaintext
   v1---v2---v3---v4---v5         master
  root        \ 
               v6---v7            feature
```

æˆ‘ä»¬å¹¶ä¸å¸Œæœ› master åˆå¹¶ feature åˆ†æ”¯ï¼Œä½†æƒ³ master ä¸Šä¹Ÿæœ‰å’Œ v7 ä¸€æ ·çš„æ”¹åŠ¨ã€‚æ­¤æ—¶å°±å¯ä»¥ç”¨ `git cherrypick {commit hash}` æŠŠ V7 æŠ“å–åˆ° master ä¸Šã€‚

### 8.1 å®éªŒè®°å½•

_(å®éªŒç”¨çš„ repo å¯ä»¥åœ¨[è¿™é‡Œä¸‹è½½](test_repo.7z)ï¼Œå†…å« master åˆ†æ”¯ï¼Œå·²æœ‰äº”ä¸ª commit)_

å’Œä¸Šä¸€èŠ‚çš„å®éªŒä¸€æ ·ï¼Œå…ˆåˆ›å»ºæ–°åˆ†æ”¯ featureï¼Œå¹¶åˆ›å»ºä¸¤ä¸ªæ–°çš„æäº¤ã€‚æŒ‰[6.2 åˆ›å»ºæ–°çš„åˆ†æ”¯](#62-åˆ›å»ºæ–°çš„åˆ†æ”¯)å†èµ°ä¸€éå°±è¡Œã€‚å¦‚æœ6.1çš„å®éªŒå·²ç»åšå®Œï¼Œå¯ä»¥åœ¨ master åˆ†æ”¯ä¸Šç›´æ¥ç”¨ `reset` æŒ‡ä»¤åˆ° V5(72f439c5), feature åˆ†æ”¯ä¸Š `reset` åˆ° V7(8aba7178) ä¹Ÿå¯ã€‚

```plaintext
$ git switch master
$ git reset --hard 72f439c5
HEAD is now at 72f439c Version 5

$ git switch feature
$ git reset --hard 8aba7178
HEAD is now at 8aba717 Version 7
```

![](images/ch08_12_rebase.png)

### 8.2 å…·ä½“æ“ä½œ

æŒ‡ä»¤ï¼š`git cherry-pick {commit hash}`

åˆ‡æ¢åˆ° master åˆ†æ”¯å» cherry-pick V7(8aba7178):

```plaintext
$ git switch master
$ git cherry-pick 8aba7178
Auto-merging hello.txt
CONFLICT (content): Merge conflict in hello.txt
CONFLICT (modify/delete): hello2.txt deleted in HEAD and modified in 8aba717 (Version 7).  Version 8aba717 (Version 7) of hello2.txt left in tree.
error: could not apply 8aba717... Version 7
hint: After resolving the conflicts, mark them with
hint: "git add/rm <pathspec>", then run
hint: "git cherry-pick --continue".
hint: You can instead skip this commit with "git cherry-pick --skip".
hint: To abort and get back to the state before "git cherry-pick",
hint: run "git cherry-pick --abort".
```

![](images/ch08_13_cherry-pick.png)

_(æ³¨æ„çœ‹å±å¹•æç¤ºè¯­ï¼Œå¦‚æƒ³ä¸­æ­¢æ“ä½œï¼Œå¯ä»¥æ‰§è¡Œ `git cherry-pick --abort`)_

ä¸å¹¸ç¢°åˆ°å†²çªï¼Œè€åŠæ³•ï¼Œç”¨ `git status` æŸ¥çœ‹å…·ä½“çš„å†²çªå†…å®¹ï¼š

```plaintext
$ git status
On branch master
You are currently cherry-picking commit 8aba717.
  (fix conflicts and run "git cherry-pick --continue")
  (use "git cherry-pick --skip" to skip this patch)
  (use "git cherry-pick --abort" to cancel the cherry-pick operation)

Unmerged paths:
  (use "git add/rm <file>..." as appropriate to mark resolution)
        both modified:   hello.txt
        deleted by us:   hello2.txt

no changes added to commit (use "git add" and/or "git commit -a")
```

![](images/ch08_14_cherry-pick.png)

æŒ‰éœ€è§£å†³ (å®éªŒä¸­è¯·éšæ„å¤„ç†ï¼Œå·¥ä½œä¸­è¯·æŒ‰ä¸šåŠ¡éœ€æ±‚å¤„ç†)ï¼š

```plaintext
$ git rm hello2.txt
$ vi hello.txt
```

æˆ‘çš„å¤„ç†æ˜¯ï¼šåˆ æ‰ hello2.txt, ç¼–è¾‘ hello.txtï¼Œå…·ä½“ç•¥ï¼Œä½ å¯ä»¥éšæ„å¤„ç†ã€‚

å¤„ç†ç»“æŸåï¼Œå°†æ–‡ä»¶ä»å·¥ä½œåŒº add åˆ°ç¼“å­˜åŒºï¼Œæœ€åæ‰§è¡Œ `--continue` æŒ‡ä»¤å³å¯ã€‚

```plaintext
$ git add .
$ git cherry-pick --continue
[master 50e9f5e] Version 7
 Date: Tue Dec 12 21:14:58 2023 +0800
 1 file changed, 2 insertions(+)
```

æœ€ç»ˆ commit tree å˜æˆè¿™æ ·ï¼š

```plaintext
   v1---v2---v3---v4---v5---v7'   master
  root        \ 
               v6---v7            feature
```

å› ä¸º commit è¢« cherry-pick å hash ä¼šå˜ï¼Œæ‰€ä»¥åœ¨ master åˆ†æ”¯ä¸Šæˆ‘ç”¨ `v7'` è¡¨ç¤ºæ–° pick çš„ commit.

![](images/ch08_15_cherry-pick.png)

ä»è¿™ä¸ªå›¾ä¸­ä¹Ÿèƒ½çœ‹å‡ºï¼Œä¸¤ä¸ª V7 çš„ hash æ˜¯ä¸åŒçš„ã€‚

## 9. è¿›é˜¶ç¯‡

_è¿›é˜¶ç¯‡çš„å†…å®¹åœ¨å¯¹ git æœ‰ä¸€å®šä½¿ç”¨ç»éªŒåé˜…è¯»æ›´ä½³ï¼Œåˆå­¦è€…å¯ä»¥è·³è¿‡ã€‚_

### 9.1 å¼ºåˆ¶åˆ‡æ¢åˆ†æ”¯

æœ‰æ—¶å¯èƒ½å› ä¸ºå½“å‰åˆ†æ”¯æœ‰æ”¹åŠ¨æ²¡æœ‰ä¿å­˜ç­‰åŸå› ï¼Œåˆ‡æ¢è¿‡å»ä¼šå¯¼è‡´å†²çªï¼Œè¿›è€Œå¯¼è‡´åˆ‡æ¢å¤±è´¥ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨ `--force` è¿›è¡Œå¼ºåˆ¶åˆ‡æ¢ï¼š

* `git switch {branch name} --force`

å¦‚ï¼š

```plaintext
$ git switch hello --force
```

ä½†å¼ºåˆ¶åˆ‡æ¢ä¹Ÿæœ‰ä¸€ä¸ªåæœï¼šä¼šä¸¢å¼ƒå½“å‰åˆ†æ”¯çš„æ‰€æœ‰æ”¹åŠ¨ã€‚

### 9.2 æ£€æŸ¥ä¸€ä¸ª commit å·²ç»åŒ…å«åœ¨å“ªäº› branch ä¸­

æŸä¸ªç‰ˆæœ¬(commit)å¯èƒ½å±äºå¤šä¸ªåˆ†æ”¯ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“æŸä¸ª commit åˆ°åº•åœ¨å“ªäº›åˆ†æ”¯ä¸Šæœ‰ï¼Œå¯ä»¥ç”¨ `git branch --contains`ï¼Œä¾‹å¦‚

æˆ‘ä»¬çŸ¥é“ V1 çš„ hash æ˜¯ 733a7c97ï¼Œå®ƒæ˜¯ master å’Œ feature å…±æœ‰èŠ‚ç‚¹ï¼Œæµ‹è¯•å¦‚ä¸‹ï¼š

```bash
$ git branch --contains 733a7c97
  feature
* master
```

è€Œ V5(72f439c5) ä»…åœ¨ master åˆ†æ”¯ä¸Šï¼Œæµ‹è¯•å¦‚ä¸‹ï¼š

```plaintext
$ git branch --contains 72f439c5
* master
```

### 9.3 ä¸¤ç§åˆ é™¤çš„ä¸åŒ

åˆ é™¤åˆ†æ”¯æ—¶ï¼Œå¯ä»¥ç”¨ `-d` ä¹Ÿå¯ä»¥ç”¨ `-D` å‚æ•°ï¼Œåˆå­¦è€…å®¹æ˜“è¿·æƒ‘ï¼Œä¸ºäº†çœäº‹ï¼Œæˆ‘ä¸€èˆ¬å°±ç”¨ `-D` å‚æ•°å¼ºåˆ¶åˆ é™¤ï¼Œä½†è¿™ä¸¤ä¸ªå‚æ•°è¿˜æ˜¯æœ‰åŒºåˆ«çš„ã€‚

* `git branch -d {branch name}` åˆ é™¤åˆ†æ”¯
* `git branch -D {branch name}` å¼ºåˆ¶åˆ é™¤åˆ†æ”¯

[å®˜æ–¹æ–‡æ¡£](https://git-scm.com/docs/git-branch)å€¼å¾—ä¸€è¯»ï¼š

> -d
>
> --delete
>
> Delete a branch. The branch must be fully merged in its upstream branch, or in HEAD if no upstream was set with > --track or --set-upstream-to.
>
> -D
>
> Shortcut for --delete --force.

### 9.4 main VS master

Git Repo çš„é»˜è®¤åˆ†æ”¯ä»å¼€å§‹ä¸€ç›´éƒ½æ˜¯ masterï¼Œä½†ä»2020å¹´çš„ç¾å›½é»‘äºº George Floyd äº‹ä»¶åï¼Œ[BLM](https://en.wikipedia.org/wiki/Black_Lives_Matter)çš„æ”¯æŒè€…åœ¨è½¯ä»¶è¡Œä¸šæå‡ºæ›¿æ¢ `master` ä¸€è¯ï¼Œgit ä»2.28.0ç‰ˆæœ¬å¼€å§‹å–æ¶ˆäº†é»˜è®¤åˆ†æ”¯çš„ç¡¬ç¼–ç ï¼Œæ”¯æŒè‡ªå®šä¹‰ã€‚

è¿™ä¸ªå€¼å¯ä»¥è°ƒæ•´ï¼š

```plaintext
$ git config init.defaultBranch
master
$ git config --global init.defaultBranch main
```

ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºä»“åº“æ—¶æŒ‡å®šé»˜è®¤åˆ†æ”¯ï¼š

```plaintext
$ git init {repo name} -b {default branch}
```

or

```plaintext
$ git init {repo name} --initial-branch={default branch}
```

ä¸ªäººè§‰å¾—æ¯”è¾ƒæ— èŠï¼Œè¿™æ˜¯ç§‘æŠ€ç•Œå‘ç§æ—ä¸»ä¹‰åˆ†å­å¦¥åçš„ä¸€ä¸ªä¾‹å­ã€‚æˆ‘å½“ç„¶æ”¯æŒé»‘äººå¹³æƒï¼Œä½†æˆ‘ä¹Ÿæ”¯æŒç™½äººé»„äººå¹³æƒã€‚é¿å…ä½¿ç”¨ master æœ‰ç‚¹æ•é£æ‰å½±ã€‚

[å®˜æ–¹æ–‡æ¡£](https://raw.githubusercontent.com/git/git/master/Documentation/RelNotes/2.28.0.txt)çš„å‚è€ƒå†…å®¹å¦‚ä¸‹ï¼š

> The name of the primary branch in existing repositories, and the default name used for the first branch in newly created repositories, is made configurable, so that we can eventually wean ourselves off of the hardcoded 'master'.

### 9.5 `checkout` VS `switch`

åˆ‡æ¢åˆ†æ”¯å¯ä»¥ç”¨ `checkout` æˆ– `switch`

* `git switch {branch name}` ç­‰åŒ `git checkout {branch name}`
* `git switch {branch name} --force` ç­‰åŒ `git checkout {branch name} --force`
* `git swtich -c {branch name}` ç­‰åŒ `git checkout -b {branch name}`

åˆ‡æ¢åˆ†æ”¯å¯ä»¥ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ `switch` æŒ‡ä»¤ï¼Œå®ƒçš„å«ä¹‰æ›´æ¸…æ™°ä¸€äº›ã€‚`checkout` è¿˜æœ‰ä¸€äº›å…¶ä»–å«ä¹‰ã€‚

### 9.6 åˆå¹¶çš„ä¸‰ç§æ¨¡å¼

`merge` æœ‰ä¸‰ç§æ¨¡å¼

1. `--ff`, å¿«è¿›
2. `--no-ff`, ç¦ç”¨å¿«è¿›
3. `--ff-only`, ä»…ç”¨å¿«è¿›

#### 9.6.1 `--ff`

ff æ˜¯ fast-forward çš„ç¼©å†™ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ã€Œå¿«é€Ÿæ¨è¿›ã€çš„æ„æ€ï¼Œè¿™é‡Œæˆ‘ç¿»è¯‘ä¸ºã€Œå¿«è¿›ã€æ¨¡å¼ã€‚

å½“ã€Œè¢«åˆå¹¶çš„åˆ†æ”¯ã€åŒ…å«ã€Œå‘èµ·åˆå¹¶çš„åˆ†æ”¯ã€çš„å…¨éƒ¨èŠ‚ç‚¹æ—¶ï¼Œgit ç›´æ¥å°† HEAD æŒ‡é’ˆç§»åŠ¨ä¸€ä¸‹å°±ç®—åˆå¹¶äº†ï¼Œè¿™ä¸ªå¾ˆã€Œå¿«ã€ã€‚

å‡å¦‚ä¸¤ä¸ªåˆ†æ”¯å½“å‰çŠ¶æ€æ˜¯è¿™æ ·çš„

```plaintext
              HEAD of master
              /
   v1---v2---v3                          branch master
  root        \ 
               v6---v7                   branch feature
                     \
                     HEAD of feature
```

åœ¨ master ä¸Šåˆå¹¶ feature

```plaintext
$ git switch master
$ git merge feature
```

ç»“æœå°±æ˜¯ master åˆ†æ”¯çš„ HEAD ç›´æ¥æŒ‡å‘ v7 å°±å®Œäº‹ï¼š

```plaintext
   v1---v2---v3      HEAD of master
  root        \      /
               v6---v7                  branch master and feature
                     \
                     HEAD of feature
```

å½“ã€Œè¢«åˆå¹¶çš„åˆ†æ”¯ã€ä¸åŒ…å«ã€Œå‘èµ·åˆå¹¶çš„åˆ†æ”¯ã€çš„å…¨éƒ¨èŠ‚ç‚¹æ—¶ï¼Œgit å°±åˆ›å»ºä¸€ä¸ªåˆå¹¶èŠ‚ç‚¹ã€‚

å‡å¦‚ä¸¤ä¸ªåˆ†æ”¯å½“å‰çŠ¶æ€æ˜¯è¿™æ ·çš„

```plaintext
                        HEAD of master
                        /
   v1---v2---v3---v4---v5                    branch master
  root        \ 
               v6---v7                       branch feature
                     \
                     HEAD of feature
```

åœ¨ master ä¸Šåˆå¹¶ feature

```plaintext
$ git switch master
$ git merge feature
```

è¿™é‡Œ master å’Œ HEAD ä¸èƒ½ç›´æ¥ç§»åŠ¨åˆ° v7ï¼Œå¦åˆ™ä¼šä¸¢ v4 å’Œ v5ï¼Œæ­¤æ—¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªåˆå¹¶èŠ‚ç‚¹ v8.

```plaintext
                             HEAD of master
                             /
   v1---v2---v3---v4---v5---v8               branch master
  root        \             /
               v6---------v7                 branch feature
                           \
                           HEAD of feature
```

ç»¼ä¸Šï¼Œgit å°½é‡ä½¿ç”¨å¿«é€Ÿçš„æ–¹å¼ï¼Œä½†å¦‚æœä¸èƒ½ã€Œå¿«è¿›ã€ï¼Œä¹Ÿä¼šåˆ›å»ºåˆå¹¶èŠ‚ç‚¹ã€‚è¿™æ˜¯ `merge` é»˜è®¤çš„æ–¹å¼ã€‚

#### 9.6.2 `--no-ff`

ç¦ç”¨ã€Œå¿«è¿›ã€æ¨¡å¼ï¼Œåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½è¦åˆ›å»ºä¸€ä¸ªåˆå…±èŠ‚ç‚¹ï¼Œå³ä½¿å¯ä»¥å¿«è¿›ã€‚

ä¸èƒ½ç”¨ã€Œå¿«è¿›ã€çš„æƒ…å†µåœ¨[9.6.1 `--ff`](#961---ff)å·²æœ‰è¯´æ˜ï¼Œè¿™é‡Œå†è¯´æ˜èƒ½ç”¨ã€Œå¿«è¿›ã€çš„æƒ…å†µå¦‚ä½•å¤„ç†ã€‚

å‡å¦‚ä¸¤ä¸ªåˆ†æ”¯å½“å‰çŠ¶æ€æ˜¯è¿™æ ·çš„

```plaintext
              HEAD of master
              /
   v1---v2---v3                          branch master
  root        \ 
               v6---v7                   branch feature
                     \
                     HEAD of feature
```

è¿™ä¸ªå‰é¢å·²ç»æåˆ°è¿‡ï¼Œé»˜è®¤ç”¨ã€Œå¿«è¿›ã€ï¼Œä½†æ˜¯åŠ äº† `--no-ff` ä¼šæ€æ ·å‘¢ï¼Ÿ

åœ¨ master ä¸Šåˆå¹¶ feature

```plaintext
$ git switch master
$ git merge --no-ff feature
```

ç»“æœä¼šæ˜¯è¿™æ ·ï¼š

```plaintext
                        HEAD of master
                        /
   v1---v2---v3-------V8                          branch master
  root        \      /
               v6---v7                            branch feature
                     \
                     HEAD of feature
```

#### 9.6.3 `--ff-only`

åªç”¨ã€Œå¿«è¿›ã€æ¨¡å¼ï¼Œèƒ½å¿«è¿›å°±å¿«è¿›ï¼Œä¸èƒ½å¿«è¿›å°±æŠ¥é”™ã€‚

èƒ½ç”¨ã€Œå¿«è¿›ã€çš„æƒ…å†µåœ¨[9.6.1 `--ff`](#961---ff)å·²æœ‰è¯´æ˜ï¼Œè¿™é‡Œå†è¯´æ˜ä¸èƒ½ç”¨å¿«è¿›çš„æƒ…å†µå¦‚ä½•å¤„ç†ã€‚

å‡å¦‚ä¸¤ä¸ªåˆ†æ”¯å½“å‰çŠ¶æ€æ˜¯è¿™æ ·çš„

```plaintext
                        HEAD of master
                        /
   v1---v2---v3---v4---v5                    branch master
  root        \ 
               v6---v7                       branch feature
                     \
                     HEAD of feature
```

åœ¨ master ä¸Šåˆå¹¶ feature, ä¸èƒ½ç”¨ã€Œå¿«è¿›ã€ï¼Œå› ä¸º feature ä¸Šä¸åŒ…å« v4 å’Œ v5. è¿™ç§æƒ…å†µä¸‹ã€‚æ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤ä¼šå‡ºç°æŠ¥é”™

```plaintext
$ git switch master
$ git merge --ff-only feature
```

æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆåš `rebase`ï¼Œå†ç»§ç»­ `merge --ff-only`:

```plaintext
$ git switch feature
$ git rebase master
$ git switch master
$ git merge --ff-only feature
```

`rebase` ä¹‹åï¼Œcommit tree æ˜¯è¿™æ ·çš„ï¼š

```plaintext
                        HEAD of master
                        /
   v1---v2---v3---v4---v5                             branch master
  root                  \ 
                        v6---v7                       branch feature
                              \
                              HEAD of feature
```

`merge --ff-only` ä¹‹åï¼Œcommit tree æ˜¯è¿™æ ·çš„ï¼š

```plaintext
   v1---v2---v3---v4---v5     HEAD of master
  root                  \     /
                        v6---v7                       branch master and feature
                              \
                              HEAD of feature
```

#### 9.6.4 å°ç»“

1. `git merge feature --ff`, fast-forward æ¨¡å¼ï¼Œé»˜è®¤æ¨¡å¼ï¼Œèƒ½ã€Œå¿«è¿›ã€å°±ã€Œå¿«è¿›ã€ï¼Œä¸èƒ½å°±åˆ›å»ºä¸€ä¸ªåˆå¹¶èŠ‚ç‚¹ã€‚
2. `git merge feature --no-ff`, non-fast-forward æ¨¡å¼ï¼Œç¦ç”¨å¿«è¿›ï¼Œä¸è®ºä»€ä¹ˆæƒ…å†µéƒ½ä¼šåˆ›å»ºä¸€ä¸ªåˆå¹¶èŠ‚ç‚¹ã€‚
3. `git merge feature --ff--only`, fast-forward only æ¨¡å¼ï¼Œåªç”¨å¿«è¿›ï¼Œä¸èƒ½ç”¨å¿«è¿›çš„æƒ…å†µå°±æŠ¥é”™ã€‚

å¦‚æœè¦ä¿®æ”¹ `merge` çš„é»˜è®¤æ¨¡å¼å¯ä»¥è®¾ç½® `merge.ff`

* `git config merge.ff false`, non-fast-forward
* `git config merge.ff only`, fast-forward only

---

[â‡¦ä¸Šä¸€ç« ](07.md) - [é¦–é¡µğŸ ](index.md) - [ä¸‹ä¸€ç« â‡¨](09.md)

<script src="https://giscus.app/client.js"
        data-repo="iridiumcao/iridiumcao.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkyOTUwNTIyODQ="
        data-category="Announcements"
        data-category-id="DIC_kwDOEZYj_M4Cxfqj"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
</script>