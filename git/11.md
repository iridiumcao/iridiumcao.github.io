# ç¬¬åä¸€ç«  æ¸…ç†ä»“åº“

[â‡¦ä¸Šä¸€ç« ](10.md) - [é¦–é¡µğŸ ](index.md) - [ä¸‹ä¸€ç« â‡¨](12.md)

---

- [ç¬¬åä¸€ç«  æ¸…ç†ä»“åº“](#ç¬¬åä¸€ç« -æ¸…ç†ä»“åº“)
  - [1. å‡†å¤‡å®éªŒ](#1-å‡†å¤‡å®éªŒ)
  - [2. `git clean`](#2-git-clean)
  - [3. `git stash`](#3-git-stash)
  - [4. `git gc`](#4-git-gc)
  - [5. æ¸…ç†æœ¬åœ°å¯¹è¿œç¨‹çš„å¼•ç”¨](#5-æ¸…ç†æœ¬åœ°å¯¹è¿œç¨‹çš„å¼•ç”¨)
  - [6. æ¸…ç†å·²åˆå¹¶çš„åˆ†æ”¯](#6-æ¸…ç†å·²åˆå¹¶çš„åˆ†æ”¯)

---

> ã€Œè‹¥æ— å¿…è¦ï¼Œå‹¿å¢å®ä½“ã€â€”â€”å¥¥å¡å§†å‰ƒåˆ€(Ockham's Razor)

Git åº“åœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„ä½¿ç”¨åï¼Œå¯èƒ½ä¼šäº§ç”Ÿä¸€äº›ã€Œåƒåœ¾ã€ï¼Œå½±å“ä½¿ç”¨ä½“éªŒï¼Œæ‰€ä»¥éœ€è¦ä¸å®šæœŸæ¸…ç†ä»¥ä¿æŒä»“åº“çš„å¥åº·ã€‚

æœ‰çš„æ¸…ç†å±äºä¸šåŠ¡å±‚é¢çš„ï¼Œè¿™äº›éœ€è¦ git ç”¨æˆ·æ ¹æ®ä¸šåŠ¡çš„æƒ…å†µè‡ªè¡Œå¤„ç†ï¼Œæ¯”å¦‚ï¼š

1. å¤šä½™çš„åˆ†æ”¯
2. é—å¼ƒçš„åˆ†æ”¯
3. é”™è¯¯çš„æ ‡ç­¾
4. ç­‰ç­‰

è¿˜æœ‰äº›å±äº git åº“æœ¬èº«çš„é—®é¢˜ï¼Œè¿™äº›æœ¬æ–‡ä¼šè¿›ä¸€æ­¥è¯´æ˜ï¼Œæ¯”å¦‚ï¼š

1. æ²¡æœ‰å¼•ç”¨çš„å¯¹è±¡
2. ä¸å­˜åœ¨çš„è¿œç¨‹çš„å¼•ç”¨
3. ç­‰ç­‰

## 1. å‡†å¤‡å®éªŒ

å‡å®šåº“å·²ç»å‡†å¤‡å¥½äº†ï¼Œå¦‚æœéœ€è¦æ–°å»ºåº“ï¼Œå¯ä»¥å‚è€ƒ[ç¬¬ä¹ç« ](09.md)ï¼Œè¿™é‡Œåªæ˜¯å‡†å¤‡ä¸€äº›æ–‡ä»¶å’Œæ–‡ä»¶å˜åŠ¨ï¼š

```plaintext
$ ls
hello
$ echo "hello2" > hello
$ echo "hello2" > hello2
$ mkdir hello3
$ cd hello3
$ echo "hello3" >> hello3
```

* hello // tracked, **åŸæœ‰**çš„æ–‡ä»¶ï¼Œä½†åšäº†ä¸€äº›æ”¹åŠ¨
* hello2 // untracked, **æ–°å¢**çš„æ–‡ä»¶
* hello3 // untracked, **æ–°å¢**çš„æ–‡ä»¶ hello3/hello3

## 2. `git clean`

`git clean` ç”¨ä»¥æ¸…ç†æœªè·Ÿè¸ªçš„æ–‡ä»¶ã€‚æœ‰æ—¶æˆ‘ä»¬ä¼šåœ¨å·¥ä½œç›®å½•é‡Œç¼–è¯‘ï¼Œæˆ–å…¶ä»–ä»€ä¹ˆæ“ä½œï¼Œç”Ÿæˆä¸€äº›ä¸å¿…è¦çš„æ–‡ä»¶ã€‚

å¼ºåˆ¶åˆ é™¤æ‰€æœ‰æœªè·Ÿè¸ªçš„æ–‡ä»¶ï¼š

```plaintext
git clean -df
```

`-d` è¡¨ç¤ºè¦åˆ—å‡ºå½“å‰ç›®å½•çš„å­ç›®å½•çš„ä¿®æ”¹æƒ…å†µ, `-f` è¡¨ç¤ºå¼ºåˆ¶åˆ é™¤äº†ï¼Œ`-df` è¡¨ç¤º `-d` å’Œ `-f` çš„åˆå†™ã€‚

å¦‚æœåªæƒ³åˆ—å‡ºå“ªäº›éœ€è¦åˆ é™¤ï¼Œå¯ä»¥ç”¨ã€Œå¹²è·‘(ç™½è·‘)ã€`--dry-run` å‚æ•°ï¼š

```plaintext
$ git clean --dry-run
Would remove hello2

$ git clean --dry-run -d
Would remove hello2
Would remove hello3/
```

ä¸Šé¢ä¹Ÿå¯è§ `-d` çš„æ•ˆæœï¼Œå¸¦ä¸Šå®ƒï¼Œä¼šåˆ—ä¸¾å­ç›®å½•çš„æƒ…å†µã€‚ä½†æ˜¯ä¸è®ºå¸¦ä¸å¸¦å®ƒï¼Œæ–‡ä»¶ `hello` æ˜¯ä¸ä¼šè§åˆ°çš„ï¼Œå› ä¸º `hello` å·²ç»è¢« git è·Ÿè¸ªäº†ï¼Œè€Œ `git clean` åªæ¸…ç†è¿˜æ²¡æœ‰è¢«è·Ÿè¸ªçš„æ–‡ä»¶çš„åŸå› ã€‚

å¦‚æœéœ€è¦äº¤äº’å¼æ“ä½œï¼Œå¯ä»¥å¸¦ä¸Š `-i` å‚æ•°ï¼š

```plaintext
$ git clean -d -i
Would remove the following items:
  hello2   hello3/
*** Commands ***
    1: clean                2: filter by pattern    3: select by numbers
    4: ask each             5: quit                 6: help
What now>
```

## 3. `git stash`

å¯¹äºå·²ç»è¿›å…¥æš‚å­˜åŒº(Stage Area)çš„æ”¹åŠ¨ï¼Œå¯ä»¥ç”¨ `stash` æ¥æ¸…ç†

```plaintext
$ git stash
```

å¦‚æœ stash stack çš„å†…å®¹éƒ½ä¸éœ€è¦äº†ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æŒ‡ä»¤æ¸…ç†æ‰

```plaintext
$ git stash clear
```

è¿˜æœ‰ä¸€ç§è¯¡å¼‚çš„æ¸…ç†æ–¹æ³•

```plaintext
$ git reset --hard HEAD
# or
$ git checkout -- .
```

* `git reset --hard HEAD` æˆ– `git reset --hard` ç¡¬é‡ç½®åˆ° HEADï¼Œå°±æ˜¯ä¸¢å¼ƒç°æœ‰æ”¹åŠ¨çš„æ„æ€
* `git checkout -- .` ç­¾å‡ºå½“å‰ç‰ˆæœ¬çš„æ‰€æœ‰æ–‡ä»¶ï¼Œè¿˜æ˜¯ä¸¢å¼ƒç°æœ‰æ”¹åŠ¨çš„æ„æ€

ä»¥ä¸Šä¸¤ä¸ªæŒ‡ä»¤å…¶å®åªè¦æ‰§è¡Œä¸€ä¸ªå°±è¡Œï¼Œä¸¤ä¸ªéƒ½æ‰§è¡Œï¼Œç®€ç›´æ˜¯åŒä¿é™©ã€‚

## 4. `git gc`

é€šå¸¸æƒ…å†µä¸‹ï¼Œæ¸…ç†æœ¬åœ°åº“ï¼Œæ‰§è¡Œ

```plaintext
$ git gc
```

å°±è¡Œäº†ã€‚

`git gc` æ‰§è¡Œæ—¶ï¼Œä¼šè°ƒç”¨ `git prune` ç­‰æŒ‡ä»¤ã€‚

## 5. æ¸…ç†æœ¬åœ°å¯¹è¿œç¨‹çš„å¼•ç”¨

æœ¬åœ°ä»“åº“æŒæœ‰è¿œç¨‹ä»“åº“çš„åˆ†æ”¯å’Œæ ‡ç­¾ä¿¡æ¯ã€‚

å¦‚æœè¿œç¨‹ä»“åº“æ–°å¢äº†åˆ†æ”¯æˆ–æ ‡ç­¾ï¼Œ`fetch / pull` æ“ä½œä¼šæŠŠå®ƒä»¬å–ä¸‹æ¥æ›´æ–°åˆ°æœ¬åœ°ï¼Œä½†å¦‚æœè¿œç¨‹ä»“åº“åˆ æ‰ä¸€äº›ï¼Œæœ¬åœ°å¹¶ä¸ä¼šåŒæ­¥åˆ é™¤ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„æŒ‡ä»¤æ¸…ç†å¤šä½™çš„å¼•ç”¨ï¼š

```plaintext
$ git fetch origin --prune --prune-tags --force
```

å¦‚æœè®¾ç½®äº†å¤šä¸ªè¿œç¨‹ä»“åº“ï¼Œå¯ä»¥ä½¿ç”¨ `--all` å‚æ•°ä¸€æ¬¡å°†æ‰€æœ‰è¿œç¨‹åº“ç›¸å…³çš„å†…å®¹éƒ½æ¸…ç†å®Œ(æ³¨æ„ï¼Œæ ¹æ®æˆ‘çš„å®é™…ä½¿ç”¨ç»éªŒï¼Œå‘ç° `--all` å‚æ•°åªæ˜¯éƒ¨åˆ†ç”Ÿæ•ˆï¼Œå»ºè®®å®ä½œæ—¶è¿˜æ˜¯æŒ‰åº“æ“ä½œ)ï¼š

```plaintext
$ git fetch --all --prune --prune-tags --force
```

ä¸Šé¢è¿™æ¡æŒ‡ä»¤ä¹Ÿå¯ä»¥ç®€å†™ä¸ºï¼š

```plaintext
$ git fetch -a -p -P -f
```

[å®˜æ–¹æ–‡æ¡£](https://git-scm.com/docs/git-fetch)çš„è¯´æ˜æ‘˜è¦å¦‚ä¸‹ï¼š

> `-p`, `--prune`, After fetching, remove any remote-tracking branches which no longer exist on the remote.
> `-P`, `--prune-tags`, Before fetching, remove any local tags that no longer exist on the remote if `--prune` is enabled.

å¦‚æœåªéœ€è¦æ¸…ç†å¤šä½™çš„å¯¹è¿œç¨‹ branch çš„å¼•ç”¨ï¼Œå¯ä»¥ç”¨ï¼š

```plaintext
$ git remote prune origin
```

å¦‚æœåªéœ€è¦æ¸…ç†æœ¬åœ°å¤šä½™çš„ tagï¼Œè¿˜å¯ä»¥è¿™æ ·ï¼š

```plaintext
$ git tag -d $(git tag)
$ git fetch --tags
```

å¯ä»¥è€ƒè™‘è®¾ç½®ä¸€ä¸ªè‡ªåŠ¨ä»»åŠ¡ï¼Œå‘¨æœŸæ€§æ‰§è¡Œï¼›ä¹Ÿå¯ä»¥è®¾ç½®ä¸€ä¸ªæ—¥å†æé†’ï¼Œæ”¶åˆ°æ¶ˆæ¯åå†æ‰‹å·¥æ‰§è¡Œã€‚

## 6. æ¸…ç†å·²åˆå¹¶çš„åˆ†æ”¯

ä»“åº“ç»è¿‡é•¿æ—¶é—´ä½¿ç”¨åï¼Œæœ‰ä¸€äº› branch å¯èƒ½å·²ç»æˆä¸ºåƒµå°¸ï¼šæ—©å·²åˆå¹¶è¿› master/main åˆ†æ”¯ï¼Œä½†å¿˜äº†åˆ é™¤ã€‚æ­¤æ—¶å¯ä»¥é€šè¿‡

```plaintext
$ git checkout master
$ git branch --merged
$ git branch -r --merged
```

æ‰¾åˆ°æœ¬åœ°å’Œè¿œç¨‹çš„è¿™äº›åˆ†æ”¯ï¼Œç„¶åæ”¾å¿ƒåˆ é™¤ã€‚æ³¨æ„åœ¨æ‰§è¡Œè¿™äº›æ“ä½œç‰¹åˆ«æ˜¯è¿œç¨‹æ“ä½œä¹‹å‰ç”¨ä¸‹åˆ—æŒ‡ä»¤å°†æœ¬åœ°åº“å’Œè¿œç¨‹åº“æ›´æ–°åˆ°ä¸€è‡´çŠ¶æ€ï¼š

```plaintext
$ git fetch --all
$ git fetch --prune --prune-tags --force
```

---

[â‡¦ä¸Šä¸€ç« ](10.md) - [é¦–é¡µğŸ ](index.md) - [ä¸‹ä¸€ç« â‡¨](12.md)

<script src="https://giscus.app/client.js"
        data-repo="iridiumcao/iridiumcao.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkyOTUwNTIyODQ="
        data-category="Announcements"
        data-category-id="DIC_kwDOEZYj_M4Cxfqj"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
</script>